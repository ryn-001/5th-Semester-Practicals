CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    department VARCHAR(30),
    year_of_study INT,
    age INT
);

CREATE TABLE Marks (
    mark_id INT PRIMARY KEY,
    student_id INT,
    subject VARCHAR(50),
    marks_obtained INT CHECK (marks_obtained BETWEEN 0 AND 100),
    FOREIGN KEY (student_id) REFERENCES Student(student_id)
);

CREATE TABLE Result (
    result_id INT PRIMARY KEY AUTO_INCREMENT,
    student_id INT,
    total_marks INT,
    percentage DECIMAL(5,2),
    grade CHAR(2),
    FOREIGN KEY (student_id) REFERENCES Student(student_id)
);

INSERT INTO Student VALUES (101, 'Riya', 'Sharma', 'CSE', 3, 20);
INSERT INTO Student VALUES (102, 'Karan', 'Patel', 'IT', 2, 19);
INSERT INTO Student VALUES (103, 'Sneha', 'Nair', 'ECE', 4, 21);
INSERT INTO Student VALUES (104, 'Arjun', 'Mehta', 'CSE', 1, 18);
INSERT INTO Student VALUES (105, 'Priya', 'Verma', 'MECH', 3, 20);

INSERT INTO Marks VALUES (1, 101, 'Database Systems', 85);
INSERT INTO Marks VALUES (2, 101, 'Operating Systems', 90);
INSERT INTO Marks VALUES (3, 102, 'Networking', 76);
INSERT INTO Marks VALUES (4, 103, 'Microprocessors', 88);
INSERT INTO Marks VALUES (5, 104, 'Mathematics', 67);
INSERT INTO Marks VALUES (6, 105, 'Thermodynamics', 79);

UPDATE Marks
SET marks_obtained = marks_obtained + 5
WHERE subject = 'Mathematics';

-- Delete students with marks < 40
DELETE s FROM Student s
JOIN Marks m ON s.student_id = m.student_id
WHERE m.marks_obtained < 40;

-- Insert into Result table
INSERT INTO Result (student_id, total_marks, percentage, grade)
SELECT 
    s.student_id,
    SUM(m.marks_obtained) AS total_marks,
    SUM(m.marks_obtained)/COUNT(m.subject) AS percentage,
    CASE 
        WHEN SUM(m.marks_obtained)/COUNT(m.subject) >= 85 THEN 'A'
        WHEN SUM(m.marks_obtained)/COUNT(m.subject) >= 70 THEN 'B'
        WHEN SUM(m.marks_obtained)/COUNT(m.subject) >= 50 THEN 'C'
        ELSE 'F'
    END AS grade
FROM Student s
JOIN Marks m ON s.student_id = m.student_id
GROUP BY s.student_id;

-- Students with grade A or B
SELECT s.first_name, s.last_name, r.grade
FROM Student s
JOIN Result r ON s.student_id = r.student_id
WHERE r.grade IN ('A', 'B');

-- Conditional selection with parentheses for precedence
SELECT * FROM Student
WHERE (department = 'CSE' AND year_of_study >= 2) OR age < 19;

-- Department stats
SELECT department, COUNT(student_id) AS total_students, AVG(age) AS avg_age
FROM Student
GROUP BY department;

-- Full name and marks gap
SELECT 
    CONCAT(UPPER(s.first_name), ' ', UPPER(s.last_name)) AS full_name,
    ABS(r.percentage - 100) AS marks_gap
FROM Result r
JOIN Student s ON s.student_id = r.student_id;

-- Top 3 students by percentage
SELECT s.first_name, s.last_name, r.percentage
FROM Student s
JOIN Result r ON s.student_id = r.student_id
WHERE r.percentage >= 70
ORDER BY r.percentage DESC
LIMIT 3;

-- Union of CSE and IT students
SELECT student_id, department FROM Student WHERE department = 'CSE'
UNION
SELECT student_id, department FROM Student WHERE department = 'IT';

-- Students with grade F or percentage < 50
SELECT s.first_name, s.last_name, r.percentage, r.grade
FROM Student s
JOIN Result r ON s.student_id = r.student_id
WHERE r.grade = 'F' OR r.percentage < 50;
